<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pahasara Studio | Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8fafc; font-family: 'Inter', sans-serif; }
    .sidebar { height: 100vh; background: #0f172a; color: white; padding: 20px; position: fixed; width: 250px; }
    .main-content { margin-left: 250px; padding: 40px; }
    .nav-link { color: #94a3b8; padding: 12px; border-radius: 8px; margin-bottom: 5px; display: block; text-decoration: none; }
    .nav-link:hover, .nav-link.active { background: #1e293b; color: white; }
    .stat-card { background: white; border: none; border-radius: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 20px; }
    .logout-btn { color: #f87171; cursor: pointer; margin-top: 50px; display: block; text-decoration: none; padding: 12px; }
  </style>
</head>
<body>

<div class="sidebar">
  <h3 class="mb-4 text-primary">Pahasara</h3>
  <a href="#" class="nav-link active">Dashboard</a>
  <a href="users.html" class="nav-link">User Management</a>
  <a href="#" class="nav-link">Bookings</a>
  <a href="#" class="nav-link">Gallery</a>
  <a onclick="logout()" class="logout-btn">Logout</a>
</div>

<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h2 id="welcomeText">Welcome back!</h2>
      <p class="text-muted">Here is what's happening at your studio today.</p>
    </div>
    <span class="badge bg-primary px-3 py-2" id="roleBadge">User</span>
  </div>

  <div class="row g-4">
    <div class="col-md-4">
      <div class="stat-card">
        <h6 class="text-muted">Total Users</h6>
        <h2 id="userCount">0</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <h6 class="text-muted">Recent Bookings</h6>
        <h2>14</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <h6 class="text-muted">Pending Invoices</h6>
        <h2>5</h2>
      </div>
    </div>
  </div>
</div>

<script>
  // 1. Session Guard: If no role is found, go back to login
  const role = localStorage.getItem("userRole");
  const email = localStorage.getItem("userEmail");

  if (!role) {
    window.location.href = "auth.html";
  }

  // 2. Populate UI
  document.getElementById("welcomeText").innerText = `Welcome, ${email}!`;
  document.getElementById("roleBadge").innerText = role;

  // 3. Fetch User Count from Backend
  async function loadStats() {
    try {
      const res = await fetch('http://localhost:8080/api/v1/users/getAll');
      const data = await res.json();
      if(data.code === "00") {
        document.getElementById("userCount").innerText = data.content.length;
      }
    } catch (err) { console.log("Stat fetch failed"); }
  }

  function logout() {
    localStorage.clear();
    window.location.href = "logout.html";
  }

  window.onload = loadStats;
</script>
</body>
</html>